(()=>{"use strict";const e=(e,t)=>{let o=[],s=parseInt(e[0],10),r=parseInt(e[1],10),a=t.squares[s][r];return{knight:function(){if(s+1<=7&&r+2<=7){const e=s+1,i=r+2;(void 0===t.squares[e][i]||void 0!==t.squares[e][i]&&t.squares[e][i].color!==a.color)&&o.push([e,i])}if(s+2<=7&&r+1<=7){const e=s+2,i=r+1;(void 0===t.squares[e][i]||void 0!==t.squares[e][i]&&t.squares[e][i].color!==a.color)&&o.push([e,i])}if(r+2<=7&&s-1>=0){const e=s-1,i=r+2;(void 0===t.squares[e][i]||void 0!==t.squares[e][i]&&t.squares[e][i].color!==a.color)&&o.push([e,i])}if(r+1<=7&&s-2>=0){const e=s-2,i=r+1;(void 0===t.squares[e][i]||void 0!==t.squares[e][i]&&t.squares[e][i].color!==a.color)&&o.push([e,i])}if(s+1<=7&&r-2>=0){const e=s+1,i=r-2;(void 0===t.squares[e][i]||void 0!==t.squares[e][i]&&t.squares[e][i].color!==a.color)&&o.push([e,i])}if(s+2<=7&&r-1>=0){const e=s+2,i=r-1;(void 0===t.squares[e][i]||void 0!==t.squares[e][i]&&t.squares[e][i].color!==a.color)&&o.push([e,i])}if(s-2>=0&&r-1>=0){const e=s-2,i=r-1;(void 0===t.squares[e][i]||void 0!==t.squares[e][i]&&t.squares[e][i].color!==a.color)&&o.push([e,i])}if(s-1>=0&&r-2>=0){const e=s-1,i=r-2;(void 0===t.squares[e][i]||void 0!==t.squares[e][i]&&t.squares[e][i].color!==a.color)&&o.push([e,i])}},king:function(){if(a.start&&void 0!==t.squares[s+3][r]&&t.squares[s+3][r].start&&void 0===t.squares[s+1][r]&&void 0===t.squares[s+2][r]&&o.push([s+2,r]),a.start&&void 0!==t.squares[s-4][r]&&t.squares[s-4][r].start&&void 0===t.squares[s-1][r]&&void 0===t.squares[s-2][r]&&void 0===t.squares[s-3][r]&&o.push([s-2,r]),s+1<=7){const e=s+1,i=r;(void 0===t.squares[e][i]||void 0!==t.squares[e][i]&&t.squares[e][i].color!==a.color)&&o.push([e,i])}if(s+1<=7&&r+1<=7){const e=s+1,i=r+1;(void 0===t.squares[e][i]||void 0!==t.squares[e][i]&&t.squares[e][i].color!==a.color)&&o.push([e,i])}if(s+1<=7&&r-1>=0){const e=s+1,i=r-1;(void 0===t.squares[e][i]||void 0!==t.squares[e][i]&&t.squares[e][i].color!==a.color)&&o.push([e,i])}if(s-1>=0){const e=s-1,i=r;(void 0===t.squares[e][i]||void 0!==t.squares[e][i]&&t.squares[e][i].color!==a.color)&&o.push([e,i])}if(s-1>=0&&r+1<=7){const e=s-1,i=r+1;(void 0===t.squares[e][i]||void 0!==t.squares[e][i]&&t.squares[e][i].color!==a.color)&&o.push([e,i])}if(s-1>=0&&r-1>=0){const e=s-1,i=r-1;(void 0===t.squares[e][i]||void 0!==t.squares[e][i]&&t.squares[e][i].color!==a.color)&&o.push([e,i])}if(r+1<=7){const e=s,i=r+1;(void 0===t.squares[e][i]||void 0!==t.squares[e][i]&&t.squares[e][i].color!==a.color)&&o.push([e,i])}if(r-1>=0){const e=s,i=r-1;(void 0===t.squares[e][i]||void 0!==t.squares[e][i]&&t.squares[e][i].color!==a.color)&&o.push([e,i])}},rook:function(){let e=1;for(;s+e<=7;)void 0===t.squares[s+e][r]?(o.push([s+e,r]),e++):(a.color===t.squares[s+e][r].color||o.push([s+e,r]),e=8);for(e=1;r+e<=7;)void 0===t.squares[s][r+e]?(o.push([s,r+e]),e++):(a.color===t.squares[s][r+e].color||o.push([s,r+e]),e=8);for(e=1;s-e>=0;)void 0===t.squares[s-e][r]?(o.push([s-e,r]),e++):(a.color===t.squares[s-e][r].color||o.push([s-e,r]),e=8);for(e=1;r-e>=0;)void 0===t.squares[s][r-e]?(o.push([s,r-e]),e++):(a.color===t.squares[s][r-e].color||o.push([s,r-e]),e=8)},bishop:function(){let e=1;for(;s+e<=7&&r+e<=7;){let i=s+e,c=r+e;void 0===t.squares[i][c]?(e++,o.push([i,c])):(t.squares[i][c].color===a.color||o.push([i,c]),e=8)}for(e=1;s+e<=7&&r-e>=0;){let i=s+e,c=r-e;void 0===t.squares[i][c]?(e++,o.push([i,c])):(t.squares[i][c].color===a.color||o.push([i,c]),e=8)}for(e=1;s-e>=0&&r+e<=7;){let i=s-e,c=r+e;void 0===t.squares[i][c]?(e++,o.push([i,c])):(t.squares[i][c].color===a.color||o.push([i,c]),e=8)}for(e=1;s-e>=0&&r-e>=0;){let i=s-e,c=r-e;void 0===t.squares[i][c]?(o.push([i,c]),e++):(t.squares[i][c].color===a.color||o.push([i,c]),e=8)}},queen:function(){this.rook(),this.bishop()},pawn:function(){"white"===a.color?(s+1<=7&&void 0!==t.squares[s+1][r]&&t.squares[s+1][r].enpasant&&t.squares[s+1][r].color!==a.color&&o.push([s+1,r+1]),s-1>=0&&void 0!==t.squares[s-1][r]&&t.squares[s-1][r].enpasant&&t.squares[s-1][r].color!==a.color&&o.push([s-1,r+1]),r+2<=7&&a.start&&void 0===t.squares[s][r+1]&&void 0===t.squares[s][r+2]&&o.push([s,r+2]),r+1<=7&&void 0===t.squares[s][r+1]&&o.push([s,r+1]),s+1<=7&&r+1<=7&&void 0!==t.squares[s+1][r+1]&&"white"!==t.squares[s+1][r+1].color&&o.push([s+1,r+1]),s-1>=0&&r+1<=7&&void 0!==t.squares[s-1][r+1]&&"white"!==t.squares[s-1][r+1].color&&o.push([s-1,r+1])):(s+1<=7&&void 0!==t.squares[s+1][r]&&t.squares[s+1][r].enpasant&&t.squares[s+1][r].color!==a.color&&o.push([s+1,r-1]),s-1>=0&&void 0!==t.squares[s-1][r]&&t.squares[s-1][r].enpasant&&t.squares[s-1][r].color!==a.color&&o.push([s-1,r-1]),r-2>=0&&a.start&&void 0===t.squares[s][r-1]&&void 0===t.squares[s][r-2]&&o.push([s,r-2]),r-1>=0&&void 0===t.squares[s][r-1]&&o.push([s,r-1]),s+1<=7&&r-1>=0&&void 0!==t.squares[s+1][r-1]&&"black"!==t.squares[s+1][r-1].color&&o.push([s+1,r-1]),s-1>=0&&r-1>=0&&void 0!==t.squares[s-1][r-1]&&"black"!==t.squares[s-1][r-1].color&&o.push([s-1,r-1]))}}[a.type](),o},t=()=>{const t=document.getElementById("placing"),o=document.getElementById("exploding");let s,r=(()=>{let e=[new Array(8),new Array(8),new Array(8),new Array(8),new Array(8),new Array(8),new Array(8),new Array(8)];return{playerFactory:e=>{const t={};return t.color=e,t.human=!1,t.king=!0,t},pieceFactory:(e,t)=>{const o={};return o.color=t,o.type=e,o.img=`../public/images/pieces/${t} ${e}.png`,o},squares:e,setPieceTo:(t,o,s,r)=>{t.start=!1,r&&(t.start=!0),e[o][s]=t}}})(),a=r.squares,i={};const c=()=>{let e=!1,t=document.querySelector("#boardSquares");for(;t.firstChild;)t.removeChild(t.firstChild);a.forEach(((o,s)=>{let r=document.createElement("tr");r.setAttribute("class","tableRow");for(let t=0;t<=7;t++){let a=document.createElement("td");a.setAttribute("class","boardSquare"),a.setAttribute("data-coords",`${s}${t}`);let i=o[t];if(void 0!==i){let e=document.createElement("img");e.setAttribute("class","pieceImg"),e.setAttribute("src",i.img),e.setAttribute("alt",`${i.color} ${i.type}`),a.setAttribute(`data-${i.color}`,""),a.appendChild(e)}!0===e?(e=!1,a.classList.add("green")):e=!0,r.appendChild(a)}e=!0!==e,t.appendChild(r)}))},l=e=>{"white"===e?s.player2.human?d("black"):p(void 0,k("black")):s.player1.human?d("white"):p(void 0,k("white"))},d=e=>{document.querySelectorAll(`[data-${e}]`).forEach((e=>{e.addEventListener("click",n),e.classList.add("active")}))},n=t=>{h(),t.target.setAttribute("id","clickedPiece");const o=e(t.target.dataset.coords,r);u(o)},u=e=>{e.forEach((e=>{let t=document.createElement("div");t.classList.add("grey");let o=document.querySelector(`[data-coords="${e[0]}${e[1]}"]`);o.classList.add("possibleMove"),o.appendChild(t),o.addEventListener("click",p)}))},p=(e,o)=>{let s,d,n,u,p;if(t.play(),o?(s=o.start,d=parseInt(s.dataset.coords[0],10),n=parseInt(s.dataset.coords[1],10),u=o.computerEnd[0],p=o.computerEnd[1]):(s=document.querySelector("#clickedPiece"),d=parseInt(s.dataset.coords[0],10),n=parseInt(s.dataset.coords[1],10),u=parseInt(e.target.dataset.coords[0],10),p=parseInt(e.target.dataset.coords[1],10)),"pawn"!==a[d][n].type||p-n!=2&&n-p!=2){if("pawn"===a[d][n].type&&a[u][n]===i&&void 0===a[u][p])return a[u][n]=void 0,r.setPieceTo(a[d][n],u,p),a[d][n]=void 0,h(),c(),void m(u,p,o);i.enpasant=!1,i=a[d][n]}else i.enpasant=!1,a[d][n].enpasant=!0,i=a[d][n];if("king"===a[d][n].type&&a[d][n].start&&(u-d==2?(r.setPieceTo(a[u+1][n],u-1,n),a[u+1][n]=void 0):u-d==-2&&(r.setPieceTo(a[u-2][n],u+1,n),a[u-2][n]=void 0)),void 0!==a[u][p])return"king"===a[u][p].type?(r.setPieceTo(a[d][n],u,p),a[d][n]=void 0,h(),c(),void alert(`${a[u][p].color} won the game!`)):(r.setPieceTo(a[d][n],u,p),a[d][n]=void 0,h(),c(),void m(u,p,o));r.setPieceTo(a[d][n],u,p),a[d][n]=void 0,h(),c(),"pawn"===a[u][p].type?7===p?v.white(u,p,o):0===p?v.black(u,p,o):l(a[u][p].color):l(a[u][p].color)},h=()=>{let e=document.querySelector("#clickedPiece");null!==e&&e.removeAttribute("id"),document.querySelectorAll(".grey").forEach((e=>{let t=e.parentElement;t.classList.remove("possibleMove"),t.removeEventListener("click",p),t.removeChild(e)}))},v={white:function(e,t,o){if(o)return a[e][t]=r.pieceFactory("queen","white"),c(),void l("white");let s=document.querySelector(`[data-coords="${e}${t}"]`),i=document.createElement("div");i.classList.add("promoting");let d=document.createElement("img");d.setAttribute("src","../public/images/pieces/white queen.png"),d.setAttribute("alt","promote to queen"),d.addEventListener("click",(()=>{a[e][t]=r.pieceFactory("queen","white"),c(),l("white")})),d.classList.add("active");let n=document.createElement("img");n.setAttribute("src","../public/images/pieces/white knight.png"),n.setAttribute("alt","promote to knight"),n.addEventListener("click",(()=>{a[e][t]=r.pieceFactory("knight","white"),c(),l("white")})),n.classList.add("active");let u=document.createElement("img");u.setAttribute("src","../public/images/pieces/white rook.png"),u.setAttribute("alt","promote to rook"),u.addEventListener("click",(()=>{a[e][t]=r.pieceFactory("rook","white"),c(),l("white")})),u.classList.add("active");let p=document.createElement("img");p.setAttribute("src","../public/images/pieces/white bishop.png"),p.setAttribute("alt","promote to bishop"),p.addEventListener("click",(()=>{a[e][t]=r.pieceFactory("bishop","white"),c(),l("white")})),p.classList.add("active");let h=document.createElement("img");h.setAttribute("src","../public/images/pieces/white pawn.png"),h.setAttribute("alt","promote to pawn"),h.addEventListener("click",(()=>{c(),l("white")})),h.classList.add("active"),i.appendChild(d),i.appendChild(n),i.appendChild(u),i.appendChild(p),i.appendChild(h),s.appendChild(i)},black:function(e,t,o){if(o)return a[e][t]=r.pieceFactory("queen","black"),c(),void l("black");let s=document.querySelector(`[data-coords="${e}${t}"]`),i=document.createElement("div");i.classList.add("promoting");let d=document.createElement("img");d.setAttribute("src","../public/images/pieces/black queen.png"),d.setAttribute("alt","promote to queen"),d.addEventListener("click",(()=>{a[e][t]=r.pieceFactory("queen","black"),c(),l("black")})),d.classList.add("active");let n=document.createElement("img");n.setAttribute("src","../public/images/pieces/black knight.png"),n.setAttribute("alt","promote to knight"),n.addEventListener("click",(()=>{a[e][t]=r.pieceFactory("knight","black"),c(),l("black")})),n.classList.add("active");let u=document.createElement("img");u.setAttribute("src","../public/images/pieces/black rook.png"),u.setAttribute("alt","promote to rook"),u.addEventListener("click",(()=>{a[e][t]=r.pieceFactory("rook","black"),c(),l("black")})),u.classList.add("active");let p=document.createElement("img");p.setAttribute("src","../public/images/pieces/black bishop.png"),p.setAttribute("alt","promote to bishop"),p.addEventListener("click",(()=>{a[e][t]=r.pieceFactory("bishop","black"),c(),l("black")})),p.classList.add("active");let h=document.createElement("img");h.setAttribute("src","../public/images/pieces/black pawn.png"),h.setAttribute("alt","promote to pawn"),h.addEventListener("click",(()=>{c(),l("black")})),h.classList.add("active"),i.appendChild(d),i.appendChild(n),i.appendChild(u),i.appendChild(p),i.appendChild(h),s.appendChild(i)}},q=(e,t)=>{let s;s=t?t.computerEnd:e.target.parentElement.parentElement.dataset.coords;let r=parseInt(s[0],10),i=parseInt(s[1],10);const d=document.querySelector(`[data-coords="${r}${i}"]`);d.classList.add("exploding"),o.play(),d.addEventListener("animationend",(()=>{if(u)return alert(`${u} has lost`),void c();h(),c(),l(n)}),{once:!0});let n=a[r][i].color,u=!1;"king"===a[r][i].type&&(u=a[r][i].color),a[r][i]=void 0,i+1<=7&&void 0!==a[r][i+1]&&("king"===a[r][i+1].type&&("king"===a[r][i+1].type&&(u=a[r][i+1].color),a[r][i+1]=void 0),a[r][i+1]=void 0),i-1>=0&&void 0!==a[r][i-1]&&("king"===a[r][i-1].type&&(u=a[r][i-1].color),a[r][i-1]=void 0),r+1<=7&&i+1<=7&&void 0!==a[r+1][i+1]&&("king"===a[r+1][i+1].type&&(u=a[r+1][i+1].color),a[r+1][i+1]=void 0),r+1<=7&&void 0!==a[r+1][i]&&("king"===a[r+1][i].type&&(u=a[r+1][i].color),a[r+1][i]=void 0),r+1<=7&&i-1>=0&&void 0!==a[r+1][i-1]&&("king"===a[r+1][i-1].type&&(u=a[r+1][i-1].color),a[r+1][i-1]=void 0),r-1>=0&&i+1<=7&&void 0!==a[r-1][i+1]&&("king"===a[r-1][i+1].type&&(u=a[r-1][i+1].color),a[r-1][i+1]=void 0),r-1>=0&&void 0!==a[r-1][i]&&("king"===a[r-1][i].type&&(u=a[r-1][i].color),a[r-1][i]=void 0),r-1>=0&&i-1>=0&&void 0!==a[r-1][i-1]&&("king"===a[r-1][i-1].type&&(u=a[r-1][i-1].color),a[r-1][i-1]=void 0)},m=(e,t,o)=>{if(o){if(!Math.round(Math.random()))return h(),c(),void("pawn"===a[e][t].type?7===t?v.white(e,t,o):0===t?v.black(e,t,o):l(a[e][t].color):l(a[e][t].color));q(void 0,o)}else{let s=document.querySelector(`[data-coords='${e}${t}']`),r=document.createElement("div");r.classList.add("attackChoice");let i=document.createElement("p");i.textContent="Normal attack",i.addEventListener("click",(()=>{h(),c(),"pawn"===a[e][t].type?7===t?v.white(e,t,o):0===t?v.black(e,t,o):l(a[e][t].color):l(a[e][t].color)}));let d=document.createElement("p");d.textContent="Explode",d.addEventListener("click",q),r.appendChild(i),r.appendChild(d),s.appendChild(r)}},k=t=>{let o=document.querySelectorAll(`[data-${t}]`),s=0,a=[];for(;0===a.length&&s<o.length;)a=e(o[s].dataset.coords,r),s++;return{start:o[s-1],computerEnd:a[a.length-1]}};return{placePieces:()=>{for(let e=0;e<=7;e++)r.setPieceTo(r.pieceFactory("pawn","white"),e,1,!0);for(let e=0;e<=7;e++)r.setPieceTo(r.pieceFactory("pawn","black"),e,6,!0);r.setPieceTo(r.pieceFactory("rook","white"),0,0,!0),r.setPieceTo(r.pieceFactory("rook","white"),7,0,!0),r.setPieceTo(r.pieceFactory("rook","black"),0,7,!0),r.setPieceTo(r.pieceFactory("rook","black"),7,7,!0),r.setPieceTo(r.pieceFactory("knight","white"),1,0),r.setPieceTo(r.pieceFactory("knight","white"),6,0),r.setPieceTo(r.pieceFactory("knight","black"),1,7),r.setPieceTo(r.pieceFactory("knight","black"),6,7),r.setPieceTo(r.pieceFactory("bishop","white"),2,0),r.setPieceTo(r.pieceFactory("bishop","white"),5,0),r.setPieceTo(r.pieceFactory("bishop","black"),2,7),r.setPieceTo(r.pieceFactory("bishop","black"),5,7),r.setPieceTo(r.pieceFactory("queen","white"),3,0),r.setPieceTo(r.pieceFactory("queen","black"),3,7),r.setPieceTo(r.pieceFactory("king","white"),4,0,!0),r.setPieceTo(r.pieceFactory("king","black"),4,7,!0)},renderBoard:c,chooseSide:e=>{let t=r.playerFactory("white"),o=r.playerFactory("black");return"1"===e?t.human=!0:o.human=!0,s={player1:t,player2:o},s},playerCanClick:d,game:r,play:p,computerAttack:k}};function o(e){document.querySelector(".pages .page.active").classList.remove("active"),document.querySelector(`.pages .page[data-page="${e}"]`).classList.add("active")}function s(e){let o=t();o.placePieces(),o.renderBoard(),document.getElementById("sidechoice").classList.add("hide"),document.getElementById("boardSquares").classList.add("tableBorder"),o.chooseSide(e.target.attributes.value.value).player1.human?o.playerCanClick("white"):o.play(void 0,o.computerAttack("white"))}window.onload=()=>{const e=document.querySelectorAll("[data-switcher]");for(let t=0;t<e.length;t++){const s=e[t],r=s.dataset.tab;s.addEventListener("click",(()=>{document.querySelector(".tabs .tab.active").classList.remove("active"),s.parentNode.classList.add("active"),o(r)}))}},document.getElementById("whitecolor").addEventListener("click",(e=>{s(e)})),document.getElementById("blackcolor").addEventListener("click",(e=>{s(e)}))})();